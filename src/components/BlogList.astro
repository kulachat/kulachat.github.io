---
import BlogCard from './BlogCard.astro';

export interface Props {
  posts: any[];
  showFeatured?: boolean;
  title?: string;
  subtitle?: string;
  limit?: number;
}

const { 
  posts, 
  showFeatured = false, 
  title = "Latest Posts", 
  subtitle = "Insights and tips for digital nomads",
  limit 
} = Astro.props;

// Filter and sort posts
let filteredPosts = posts.filter(post => !post.data.draft);

if (showFeatured) {
  filteredPosts = filteredPosts.filter(post => post.data.featured);
}

// Sort by publish date (newest first)
filteredPosts.sort((a, b) => new Date(b.data.publishDate).getTime() - new Date(a.data.publishDate).getTime());

// Apply limit if specified
if (limit) {
  filteredPosts = filteredPosts.slice(0, limit);
}

const featuredPosts = filteredPosts.filter(post => post.data.featured);
const regularPosts = filteredPosts.filter(post => !post.data.featured);
---

<section class="py-12">
  <div class="container mx-auto px-4">
    {(title || subtitle) && (
      <div class="text-center mb-12">
        {title && (
          <h2 class="text-3xl md:text-4xl font-bold text-white mb-4">
            {title}
          </h2>
        )}
        {subtitle && (
          <p class="text-xl text-gray-300 max-w-2xl mx-auto">
            {subtitle}
          </p>
        )}
      </div>
    )}
    
    {filteredPosts.length === 0 ? (
      <div class="text-center py-12">
        <div class="text-6xl mb-4">ğŸ“</div>
        <h3 class="text-2xl font-bold text-white mb-2">No posts found</h3>
        <p class="text-gray-400">Check back soon for new content!</p>
      </div>
    ) : (
      <div>
        {/* Featured Posts - Full width layout */}
        {featuredPosts.length > 0 && (
          <div class="mb-12">
            <h3 class="text-2xl font-bold text-white mb-6 flex items-center gap-2">
              <svg class="w-6 h-6 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
              </svg>
              Featured Posts
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
              {featuredPosts.map(post => (
                <BlogCard
                  title={post.data.title}
                  description={post.data.description}
                  author={post.data.author}
                  publishDate={post.data.publishDate}
                  category={post.data.category}
                  tags={post.data.tags}
                  image={post.data.image}
                  readingTime={post.data.readingTime}
                  slug={post.slug}
                  featured={post.data.featured}
                />
              ))}
            </div>
          </div>
        )}
        
        {/* Regular Posts Grid */}
        {regularPosts.length > 0 && (
          <div>
            {featuredPosts.length > 0 && (
              <h3 class="text-2xl font-bold text-white mb-6">Latest Posts</h3>
            )}
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
              {regularPosts.map(post => (
                <BlogCard
                  title={post.data.title}
                  description={post.data.description}
                  author={post.data.author}
                  publishDate={post.data.publishDate}
                  category={post.data.category}
                  tags={post.data.tags}
                  image={post.data.image}
                  readingTime={post.data.readingTime}
                  slug={post.slug}
                  featured={false}
                />
              ))}
            </div>
          </div>
        )}
      </div>
    )}
  </div>
</section>